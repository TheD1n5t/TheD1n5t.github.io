<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mächtiger Donut - LoL Stats</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 3rem auto;
      padding: 1rem;
      background-color: #1e1e1e;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #ffcc00;
    }
    #summoner-info p {
      text-align: center;
      font-size: 1.2rem;
    }
    input, button {
      display: block;
      margin: 1rem auto;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
    }
    input {
      width: 80%;
    }
    button {
      background-color: #ffcc00;
      color: #121212;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>LoL Stats per Riot ID</h1>
    <input type="text" id="riotIdInput" placeholder="z. B. Mächtiger Donut#EUW" />
    <button onclick="loadByRiotId()">Riot ID laden</button>
    <div id="summoner-info">
      <p>Bitte Riot ID eingeben.</p>
    </div>
  </div>

  <script>
    async function loadByRiotId() {
      const input = document.getElementById("riotIdInput").value;
      const infoDiv = document.getElementById("summoner-info");
      infoDiv.innerHTML = "<p>Lade Daten...</p>";

      const [gameName, tagLine] = input.split("#");
      if (!gameName || !tagLine) {
        infoDiv.innerHTML = "<p style='color: red;'>Bitte eine gültige Riot ID im Format Name#Tag eingeben.</p>";
        return;
      }

      try {
        const proxyUrl = "https://lol-api-proxy.onrender.com";

        const riotRes = await fetch(`${proxyUrl}/riotid/${encodeURIComponent(gameName)}/${encodeURIComponent(tagLine)}`);
        const riotData = await riotRes.json();
        if (!riotData.puuid) throw new Error("Riot ID nicht gefunden.");

        const summRes = await fetch(`${proxyUrl}/summoner/by-puuid/${riotData.puuid}`);
        const summData = await summRes.json();
        if (!summData.id || !summData.summonerLevel) throw new Error("Summoner-Daten unvollständig.");

        // Ranked Stats abrufen
        const rankedRes = await fetch(`${proxyUrl}/ranked/by-summoner/${summData.id}`);
        const rankedData = await rankedRes.json();

        let rankedInfo = "<p><em>Keine Ranked-Daten verfügbar.</em></p>";
        if (Array.isArray(rankedData)) {
          const soloQueue = rankedData.find(entry => entry.queueType === "RANKED_SOLO_5x5");
          if (soloQueue) {
            const { tier, rank, leaguePoints, wins, losses } = soloQueue;
            const winrate = Math.round((wins / (wins + losses)) * 100);
            rankedInfo = `
              <p><strong>Rang:</strong> ${tier} ${rank} – ${leaguePoints} LP</p>
              <p><strong>Wins:</strong> ${wins} – <strong>Losses:</strong> ${losses}</p>
              <p><strong>Winrate:</strong> ${winrate}%</p>
            `;
          }
        } else {
          console.warn("Ranked API Antwort war kein Array:", rankedData);
        }

        // Match-History (letzte 5 Spiele)
        const matchIdsRes = await fetch(`${proxyUrl}/matches/by-puuid/${riotData.puuid}?count=5`);
        const matchIds = await matchIdsRes.json();

        let matchHistory = "<p><strong>Letzte Spiele:</strong></p><ul>";
        for (const matchId of matchIds) {
          const matchRes = await fetch(`${proxyUrl}/match/${matchId}`);
          const matchData = await matchRes.json();
          const player = matchData.info.participants.find(p => p.puuid === riotData.puuid);
          if (player) {
            const result = player.win ? "<span style='color:lightgreen;'>Sieg</span>" : "<span style='color:orangered;'>Niederlage</span>";
            matchHistory += `<li>${player.championName} – ${player.kills}/${player.deaths}/${player.assists} – ${result}</li>`;
          }
        }
        matchHistory += "</ul>";

        infoDiv.innerHTML = `
          <p><strong>Name:</strong> ${riotData.gameName}</p>
          <p><strong>Level:</strong> ${summData.summonerLevel}</p>
          <img src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/${summData.profileIconId}.png" 
              alt="Profile Icon" width="64" height="64" />
          <div style="margin-top: 1rem;">${rankedInfo}</div>
          <div style="margin-top: 1rem;">${matchHistory}</div>
        `;
      } catch (err) {
        infoDiv.innerHTML = `<p style='color: red;'>Fehler beim Laden der Daten:<br>${err.message}</p>`;
        console.error("Fehler beim Laden:", err);
      }
    }
  </script>
</body>
</html>
