<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mächtiger Donut - LoL Stats</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>LoL Stats per Riot ID</h1>
    <input type="text" id="riotIdInput" placeholder="z. B. Mächtiger Donut#EUW" />
    <button onclick="loadByRiotId()">Riot ID laden</button>

    <div id="summoner-info">
      <p>Bitte Riot ID eingeben.</p>
    </div>

    <div id="match-history">
      <!-- Dynamische Match History wird hier geladen -->
    </div>
  </div>

  <script>
    async function loadByRiotId() {
  const input = document.getElementById("riotIdInput").value;
  const infoDiv = document.getElementById("summoner-info");
  const matchHistoryDiv = document.getElementById("match-history");
  infoDiv.innerHTML = "<p>Lade Daten...</p>";

  const [gameName, tagLine] = input.split("#");
  if (!gameName || !tagLine) {
    infoDiv.innerHTML = "<p style='color: red;'>Bitte eine gültige Riot ID im Format Name#Tag eingeben.</p>";
    return;
  }

  try {
    const proxyUrl = "https://lol-api-proxy.onrender.com";

    // Riot ID abrufen
    const riotRes = await fetch(`${proxyUrl}/riotid/${encodeURIComponent(gameName)}/${encodeURIComponent(tagLine)}`);
    const riotData = await riotRes.json();
    if (!riotData.puuid) throw new Error("Riot ID nicht gefunden.");

    // Summoner-Daten abrufen
    const summRes = await fetch(`${proxyUrl}/summoner/by-puuid/${riotData.puuid}`);
    const summData = await summRes.json();
    if (!summData.id || !summData.summonerLevel) throw new Error("Summoner-Daten unvollständig.");

    // Match-History (letzte 5 Spiele)
    const matchIdsRes = await fetch(`${proxyUrl}/matches/by-puuid/${riotData.puuid}?count=5`);
    const matchIds = await matchIdsRes.json();

    let matchHistoryHTML = "<h2>Letzte Spiele:</h2>";
    for (const matchId of matchIds) {
      const matchRes = await fetch(`${proxyUrl}/match/${matchId}`);
      const matchData = await matchRes.json();
      const player = matchData.info.participants.find(p => p.puuid === riotData.puuid);

      if (player) {
        const result = player.win ? "<span style='color:lightgreen;'>Sieg</span>" : "<span style='color:orangered;'>Niederlage</span>";
        const championIcon = `https://ddragon.leagueoflegends.com/cdn/13.24.1/img/champion/${player.championName}.png`;

        // Sicherstellen, dass player.items definiert ist und nicht leer ist
        const items = Array.isArray(player.items) && player.items.length > 0 ? player.items : [];

        // Dynamisch Item-Bilder rendern, falls vorhanden
        const itemElements = items.length > 0 
          ? items.map(itemId => 
              `<img src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/item/${itemId}.png" />`).join('')
          : "<p>Keine Items verfügbar.</p>";

        matchHistoryHTML += `
          <div class="match-card ${player.win ? 'win' : 'loss'}">
            <div class="match-mode">
              <div class="mode">${matchData.info.queueId === 420 ? 'Ranked' : 'Normal'}</div>
              <div class="time">${new Date(matchData.info.gameCreation).toLocaleString()}</div>
              <div class="duration">${Math.floor(matchData.info.gameDuration / 60)} Min</div>
            </div>

            <div class="champion-block">
              <div class="champion">
                <img class="champ-icon" src="${championIcon}" alt="${player.championName}" />
                <div class="level">${player.championLevel}</div>
              </div>
              <div class="spells-runes">
                <img class="spell" src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/spell/${player.summoner1Id}.png" />
                <img class="spell" src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/spell/${player.summoner2Id}.png" />
              </div>
            </div>

            <div class="stats">
              <div class="kda">${player.kills} / ${player.deaths} / ${player.assists}</div>
              <div class="kda-ratio">${Math.round((player.kills + player.assists) / player.deaths)}:1 KDA</div>
            </div>

            <div class="items">
              ${itemElements}
            </div>
          </div>
        `;
      }
    }

    matchHistoryDiv.innerHTML = matchHistoryHTML;
  } catch (err) {
    infoDiv.innerHTML = `<p style='color: red;'>Fehler beim Laden der Daten:<br>${err.message}</p>`;
    console.error("Fehler beim Laden:", err);
  }
}


  </script>
</body>
</html>
